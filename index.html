<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Quiver — Surf Report</title>
<link href="https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@0,700;0,900;1,700;1,900&family=Inter:wght@400;500;600&family=DM+Mono:wght@300;400&display=swap" rel="stylesheet">
<style>
:root {
  --bg: #f5f0e8;
  --navy: #0d2545;
  --cream2: #ede7d6;
  --sky: #2a6496;
  --yellow: #d4a012;
  --coral: #c94028;
  --green: #1a6b3c;
  --fog: rgba(13,37,69,0.55);
  --muted: rgba(13,37,69,0.4);
}
* { margin:0; padding:0; box-sizing:border-box; }
body { background:var(--bg); color:var(--navy); font-family:'Inter', sans-serif; }

body::after {
  content:''; position:fixed; inset:0; pointer-events:none; z-index:9999;
  background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 512 512' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.65' numOctaves='4' stitchTiles='stitch'/%3E%3CfeColorMatrix type='saturate' values='0'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23n)'/%3E%3C/svg%3E");
  opacity:0.1; mix-blend-mode:multiply;
}

header {
  background:var(--navy); padding:18px 32px;
  display:flex; align-items:center; justify-content:space-between;
}
.logo {
  font-family:'Playfair Display', serif;
  font-size:20px; font-weight:900; font-style:italic;
  color:#f5f0e8; letter-spacing:2px;
}
.logo-tag {
  font-family:'DM Mono', monospace;
  font-size:8px; letter-spacing:3px; text-transform:uppercase;
  color:rgba(245,240,232,0.35); margin-top:2px;
}

.hero {
  background:var(--navy); padding:48px 32px 56px;
  text-align:center; position:relative; overflow:hidden;
}
.hero::before {
  content:''; position:absolute; bottom:0; left:0; right:0; height:40px;
  background:var(--bg); clip-path:ellipse(55% 100% at 50% 100%);
}
.break-name {
  font-family:'Playfair Display', serif;
  font-size:clamp(48px, 9vw, 88px);
  font-weight:900; font-style:italic;
  color:#f5f0e8; line-height:1; margin-bottom:10px;
}
.break-location {
  font-family:'DM Mono', monospace;
  font-size:10px; letter-spacing:3px; text-transform:uppercase;
  color:rgba(245,240,232,0.4);
}

.main { max-width:900px; margin:0 auto; padding:40px 24px 80px; }

/* RATING */
.rating-badge {
  display:inline-block;
  font-family:'Inter', sans-serif;
  font-size:12px; font-weight:600; letter-spacing:1px; text-transform:uppercase;
  padding:6px 16px; margin-bottom:20px;
}
.rating-epic   { background:var(--green); color:#f5f0e8; }
.rating-good   { background:var(--sky); color:#f5f0e8; }
.rating-fair   { background:var(--yellow); color:#1a1a1a; }
.rating-poor   { background:var(--coral); color:#f5f0e8; }
.rating-flat   { background:var(--cream2); color:var(--navy); }

/* CURRENT */
.current-card {
  background:var(--navy); padding:28px 32px; margin-bottom:24px; color:#f5f0e8;
}
.card-label {
  font-family:'DM Mono', monospace;
  font-size:9px; letter-spacing:3px; text-transform:uppercase;
  color:rgba(245,240,232,0.35); margin-bottom:20px;
}
.current-grid {
  display:grid; grid-template-columns:repeat(4,1fr); gap:20px;
}
.current-val {
  font-family:'Playfair Display', serif;
  font-size:clamp(32px, 5vw, 48px);
  font-weight:900; font-style:italic;
  color:#f5f0e8; line-height:1;
}
.current-unit {
  font-size:14px; font-weight:400; font-style:normal;
  opacity:0.5; margin-left:2px;
}
.current-stat-label {
  font-family:'DM Mono', monospace;
  font-size:9px; letter-spacing:2px; text-transform:uppercase;
  color:rgba(245,240,232,0.35); margin-top:6px;
}

/* FORECAST */
.section-label {
  font-family:'DM Mono', monospace;
  font-size:9px; letter-spacing:3px; text-transform:uppercase;
  color:var(--muted); margin-bottom:10px; margin-top:32px;
  display:flex; align-items:center; gap:12px;
}
.section-label::before { content:''; width:20px; height:1px; background:var(--muted); }

.forecast-grid {
  display:grid;
  grid-template-columns:repeat(auto-fill, minmax(105px, 1fr));
  gap:2px;
}
.forecast-slot {
  background:var(--cream2); padding:16px 12px; text-align:center;
  border-top:2px solid transparent; transition:background 0.15s;
}
.forecast-slot:hover { background:#e5deca; }
.forecast-slot.best { border-top-color:var(--sky); }
.slot-time {
  font-family:'DM Mono', monospace;
  font-size:9px; letter-spacing:1px;
  color:var(--muted); margin-bottom:10px;
}
.slot-height {
  font-family:'Playfair Display', serif;
  font-size:24px; font-weight:900; font-style:italic;
  color:var(--navy); line-height:1;
}
.slot-unit { font-size:11px; font-style:normal; opacity:0.5; }
.slot-detail {
  font-family:'DM Mono', monospace;
  font-size:8px; letter-spacing:0.5px; text-transform:uppercase;
  color:var(--muted); margin-top:6px; line-height:1.6;
}

/* TIDES */
.tide-grid {
  display:grid; grid-template-columns:repeat(auto-fill, minmax(150px,1fr)); gap:2px;
}
.tide-card {
  background:var(--cream2); padding:16px 18px;
  display:flex; align-items:center; gap:14px;
}
.tide-arrow { font-size:18px; }
.tide-type {
  font-family:'DM Mono', monospace;
  font-size:8px; letter-spacing:2px; text-transform:uppercase;
  color:var(--muted); margin-bottom:2px;
}
.tide-time {
  font-family:'Inter', sans-serif;
  font-size:18px; font-weight:600; color:var(--navy);
}
.tide-height {
  font-family:'DM Mono', monospace;
  font-size:9px; color:var(--muted); margin-top:2px;
}

.status {
  text-align:center; padding:80px 24px;
  font-family:'Inter', sans-serif;
  font-size:16px; color:var(--fog);
}
.error { color:var(--coral); }

@media (max-width:600px) {
  .current-grid { grid-template-columns:repeat(2,1fr); }
  header { padding:16px 20px; }
  .hero { padding:36px 20px 48px; }
  .main { padding:28px 16px 60px; }
  .current-card { padding:22px 20px; }
}
</style>
</head>
<body>

<header>
  <div>
    <div class="logo">Quiver</div>
    <div class="logo-tag">Surf Guide</div>
  </div>
</header>

<div class="hero">
  <div class="break-name">Lahinch</div>
  <div class="break-location">Co. Clare · Ireland · 52.9337° N, 9.3544° W</div>
</div>

<main class="main">
  <div id="app"><div class="status">Loading forecast...</div></div>
</main>

<script>
const LAT = 52.9337;
const LNG = -9.3544;

function getWindDir(deg) {
  const dirs = ['N','NE','E','SE','S','SW','W','NW'];
  return dirs[Math.round(deg / 45) % 8];
}

function getRating(waveHeight, windSpeed, swellPeriod) {
  if (waveHeight < 0.3) return { label:'Flat', cls:'flat' };
  if (waveHeight >= 1.5 && swellPeriod >= 12 && windSpeed < 5) return { label:'Epic', cls:'epic' };
  if (waveHeight >= 0.8 && swellPeriod >= 9 && windSpeed < 10) return { label:'Good', cls:'good' };
  if (waveHeight >= 0.5 && windSpeed < 15) return { label:'Fair', cls:'fair' };
  return { label:'Poor', cls:'poor' };
}

function fmt(date) {
  return new Date(date).toLocaleTimeString('en-IE', { hour:'2-digit', minute:'2-digit', hour12:false });
}

async function loadForecast() {
  const app = document.getElementById('app');
  try {
    const res = await fetch('/api/forecast');
    if (!res.ok) throw new Error('API error ' + res.status);
    const data = await res.json();
    const hours = data.hours;
    if (!hours || hours.length === 0) throw new Error('No data returned');

    const now = hours[0];
    const waveH  = now.waveHeight?.noaa   ?? now.waveHeight?.sg   ?? 0;
    const windS  = now.windSpeed?.noaa    ?? now.windSpeed?.sg    ?? 0;
    const windD  = now.windDirection?.noaa ?? now.windDirection?.sg ?? 0;
    const period = now.swellPeriod?.noaa  ?? now.swellPeriod?.sg  ?? 0;
    const rating = getRating(waveH, windS, period);

    const slots = hours.slice(0, 24).filter((_, i) => i % 3 === 0);
    const tides = data.tides || [];

    app.innerHTML = `
      <span class="rating-badge rating-${rating.cls}">${rating.label} conditions</span>

      <div class="current-card">
        <div class="card-label">Current Conditions · ${new Date(now.time).toLocaleString('en-IE', { weekday:'long', hour:'2-digit', minute:'2-digit' })}</div>
        <div class="current-grid">
          <div>
            <div class="current-val">${waveH.toFixed(1)}<span class="current-unit">m</span></div>
            <div class="current-stat-label">Wave Height</div>
          </div>
          <div>
            <div class="current-val">${period.toFixed(0)}<span class="current-unit">s</span></div>
            <div class="current-stat-label">Swell Period</div>
          </div>
          <div>
            <div class="current-val">${windS.toFixed(0)}<span class="current-unit">kn</span></div>
            <div class="current-stat-label">Wind · ${getWindDir(windD)}</div>
          </div>
          <div>
            <div class="current-val">${(waveH * 3.28).toFixed(1)}<span class="current-unit">ft</span></div>
            <div class="current-stat-label">In Feet</div>
          </div>
        </div>
      </div>

      <div class="section-label">Next 24 Hours</div>
      <div class="forecast-grid">
        ${slots.map(h => {
          const wh = h.waveHeight?.noaa ?? h.waveHeight?.sg ?? 0;
          const ws = h.windSpeed?.noaa  ?? h.windSpeed?.sg  ?? 0;
          const wd = h.windDirection?.noaa ?? h.windDirection?.sg ?? 0;
          const sp = h.swellPeriod?.noaa ?? h.swellPeriod?.sg ?? 0;
          const r  = getRating(wh, ws, sp);
          const best = r.cls === 'good' || r.cls === 'epic';
          return `
            <div class="forecast-slot ${best ? 'best' : ''}">
              <div class="slot-time">${fmt(h.time)}</div>
              <div class="slot-height">${wh.toFixed(1)}<span class="slot-unit">m</span></div>
              <div class="slot-detail">${getWindDir(wd)} ${ws.toFixed(0)}kn<br>${sp.toFixed(0)}s</div>
            </div>`;
        }).join('')}
      </div>

      ${tides.length > 0 ? `
        <div class="section-label" style="margin-top:32px">Tides</div>
        <div class="tide-grid">
          ${tides.slice(0, 6).map(t => `
            <div class="tide-card">
              <div class="tide-arrow">${t.type === 'high' ? '↑' : '↓'}</div>
              <div>
                <div class="tide-type">${t.type === 'high' ? 'High' : 'Low'} Tide</div>
                <div class="tide-time">${fmt(t.time)}</div>
                <div class="tide-height">${t.height?.toFixed(1)}m</div>
              </div>
            </div>`).join('')}
        </div>` : ''}
    `;
  } catch(err) {
    app.innerHTML = `<div class="status error">Couldn't load forecast — ${err.message}</div>`;
  }
}

loadForecast();
</script>
</body>
</html>
